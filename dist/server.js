!function(e){var s={};function o(t){if(s[t])return s[t].exports;var r=s[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=e,o.c=s,o.d=function(e,s,t){o.o(e,s)||Object.defineProperty(e,s,{enumerable:!0,get:t})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,s){if(1&s&&(e=o(e)),8&s)return e;if(4&s&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(o.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&s&&"string"!=typeof e)for(var r in e)o.d(t,r,function(s){return e[s]}.bind(null,r));return t},o.n=function(e){var s=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(s,"a",s),s},o.o=function(e,s){return Object.prototype.hasOwnProperty.call(e,s)},o.p="",o(o.s=0)}([function(e,s,o){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const t=o(1),r=o(2),n=o(3),i=o(4),a=o(6),u=a.create(),l=a.router("./db.json"),c=JSON.parse(r.readFileSync("./users.json","UTF-8")),d=o(7);u.use(a.defaults()),u.use(t.urlencoded({extended:!0})),u.use(t.json({limit:"50mb"})),u.use(t.urlencoded({limit:"50mb",extended:!0})),s.createUser=(({eMail:e,password:s})=>{c.users.push({eMail:e,password:s});const o=JSON.stringify(c,null,2);return r.writeFileSync("users.json",o),o}),s.resync=(()=>{console.log("resync function");let e=d("/home/Server/dist/db.json");return console.log(e),l.db.assign(d("/home/Server/dist/db.json")).write()}),s.createToken=(e=>n.sign(e,"verySecretJwtPW",{expiresIn:"1h"})),s.verifyToken=(e=>n.verify(e,"verySecretJwtPW",(e,s)=>{if(e){return[403,e]}return s})),s.isLoginCorrect=(({eMail:e,password:s})=>-1!==c.users.findIndex(o=>o.eMail===e&&o.password===s)),s.isUserAvailable=(({eMail:e})=>-1!==c.users.findIndex(s=>s.eMail===e)),u.post("/sendmail",(e,o)=>{const t={eMail:e.body.eMail,password:e.body.password};console.log(e.body.eMail),console.log(e.body.password);const r="Hello,\nPlease click on the link to verify your eMail:\n\n"+`http://couponing24.ddns.net:3030/auth/createlogin/${s.createToken(t)}`+"\n\nbest regards\n\nyour team xyz",n=i.sendMail("gmail","teufelsilvan@gmail.com","stefan234",e.body.eMail,"Nodemail",r);return o.status(200).json({status:200,message:n,user:t})}),u.get("/auth/createlogin/:key",(e,o)=>{console.log("one");const t=JSON.stringify(s.verifyToken(e.params.key)),r=JSON.parse(t),{eMail:n,password:i}=r;if(console.log("two"),o.status(200).redirect("http://couponing24.ddns.net:5000/#/LoginPage"),s.isUserAvailable({eMail:n})){const e=401,s="eMail already exists";return o.status(e).json({status:e,message:s})}if(console.log("three"),!i){const e=401,s="Password is not defined";return o.status(e).json({status:e,message:s})}if(console.log("four"),!n){const e=401,s="eMail is not defined";return o.status(e).json({status:e,message:s})}console.log("five");const a={};a[n]=[],console.log(a),l.db.defaults(a).write();const u=d("/home/Server/dist/db.json");return l.db.assign(u).write(),s.createUser({eMail:n,password:i}),console.log("seven"),console.log("eight"),0}),u.post("/auth/login",(e,o)=>{const{eMail:t,password:r}=e.body;if(console.log(t),console.log(r),!s.isLoginCorrect({eMail:t,password:r})){const e=401,s="Incorrect eMail or password";return o.status(e).json({status:e,message:s})}const n=s.createToken({eMail:t,password:r});return console.log(n),o.status(200).json({access_token:n})}),u.post("/auth/verify",(e,o)=>{if(!e.headers.authorization){const e=401,s="Bad authorization header";return o.status(e).json({status:e,message:s})}try{const t=s.verifyToken(e.headers.authorization);return o.status(200).json(t)}catch(e){const s=401,t="Error: access_token is not valid";return o.status(s).json({status:s,message:t})}}),u.use("/:link",(e,o,t)=>{const r=e.params.link,n=e.method;if(console.log("link:"+r),"public"===r&&"GET"===n)return console.log("GET TO PUBLIC-TABLE!"),t();if(!e.headers.authorization){const e=401,s="Bad authorization header";return o.status(e).json({status:e,message:s})}if(403===s.verifyToken(e.headers.authorization)[0]){const t=s.verifyToken(e.headers.authorization)[0],r=s.verifyToken(e.headers.authorization)[1];return o.status(t).json({status:t,message:r})}console.log("TOKEN CORRECT!");const i=JSON.stringify(s.verifyToken(e.headers.authorization)),a=JSON.parse(i),u=Number(e.body.publicid),c=l.db.get("public").find({id:u}).value();if(console.log(c),console.log("link:"+r+"///user:"+a.eMail),"admin"===a.eMail)return t();if(r===a.eMail)return t();if("public"===r&&"POST"===n)return t();if("public"===r&&c.eMail===a.eMail)return t();return o.status(401).json({status:401,message:"User-specific-Error"})}),u.use(l),u.listen(3030,()=>{console.log("Run JSON-Server with Auth API Server")})},function(e,s){e.exports=require("body-parser")},function(e,s){e.exports=require("fs")},function(e,s){e.exports=require("jsonwebtoken")},function(e,s,o){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const t=o(5);s.sendMail=((e,s,o,r,n,i)=>{((e,s,o)=>{return t.createTransport({service:e,auth:{user:s,pass:o}})})(e,s,o).sendMail(((e,s,o,t)=>{return{from:e,to:s,subject:o,text:t}})(s,r,n,i),(e,s)=>e?(console.log(e),e):(console.log("Email sent: "+s.response),s.response))})},function(e,s){e.exports=require("nodemailer")},function(e,s){e.exports=require("json-server")},function(e,s){e.exports=require("import-fresh")}]);